# What this does...
# Install compiz docker container over the host desktop for wobbly windows and other special effects


# Install xfce4-desktop ( Clear Linux OS related )
swupd bundle-add xfce4-desktop

# Disable graphical target and create .xinitrc
sudo systemctl set-default multi-user.target 
echo "exec xfce4-session" > $HOME/.xinitrc
reboot, login and type startx

# Xfce4 desktop
echo -e "FROM ubuntu \\nRUN apt update \\nRUN apt upgrade -y\\nRUN apt update -y" > /tmp/Dockerfile
sudo docker build -t compiz < /tmp/Dockerfile -
xhost local:${USER}
sudo docker run -it --privileged -v /dev/shm:/dev/shm:rw --net=host -e DISPLAY=${DISPLAY} compiz

# Inside the docker container command line
apt install compizconfig-settings-manager compiz fusion-icon emerald curl


# Save the container at this point
sudo docker ps
sudo docker commit <CONTAINER ID>  compiz  # Replace Container ID with what is shown after your type sudo docker ps

# Configure Compiz
ccsm
# Turn on these plugins
# Composite, OpenGL, Window Decorations, Wobbly Windows, Grid, Move Window, Place Window, Resize Window, Shift Switcher

# Load compiz
compiz --replace &

# If things went well save the container again

# Turn off compiz
# Open up terminal on the host side
xfwm4 --replace &


# Install nvidia drivers if you want
# From inside the container...
# The screen may not do any thing for about 30 secs
# Test with nvidia-smi
# Dowanload Nvidia driver https://www.nvidia.com/en-us/drivers/unix/
bash ./NVIDIA-Linux-<your driver here>.run --accept-license --ui=none --no-kernel-module --no-questions


# Issues
# If you exit the container without first running xfwm4 --replace & on the host, your windows will have no borders.
# Try to right click on the desktop and logout and restart X with startx



# Enable graphical targer to fallback and ignore .xinirtc
# sudo systemctl set-default graphical.target
