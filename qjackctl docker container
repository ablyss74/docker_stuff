# What this does... 
# Build a docker container from the command prompt and run qjackctl in realtime.
# There are known issues that I haven't resolved and will discuss more about that below.


# Set realtime sched on the host machine
# The default value on my OS "Clear Linux" is 950000 and defaults to that value on every reboot.
# Be sure to not copy/paste both lines at once, but instead both separately. 
sudo bash # Copy this line first
echo "-1" > /proc/sys/kernel/sched_rt_runtime_us && exit  ## Copy this next


# Set xhost to accept connections from the docker container
xhost local:${USER}

# Load module snd_seq 
sudo modprobe snd_seq


# Pull docker image.  If you haven't already installed docker do that now by following the instructions provided by your OS

echo -e "FROM ubuntu \\nRUN apt update \\nRUN apt upgrade -y\\nRUN apt update -y\\nRUN apt install qjackctl -y" > /tmp/Dockerfile
sudo docker build -t qjackctl < /tmp/Dockerfile -
sudo docker run -it --privileged -e JACK_NO_AUDIO_RESERVATION=1 -v /dev/shm:/dev/shm:rw --net=host -e DISPLAY=${DISPLAY} qjackctl

# Container Prompt
qjackctl &

# Do not exit without saving container.. see next step

# Save the docker container - So we do not have to repeat all the steps again we need to save the docker container
# 1. sudo docker ps
# 2. sudo docker commit <CONTAINER ID> qjackctl # Replace Container ID with the first ID shown after your type sudo docker ps

# Delete docker contianer - If you need to start fresh or whatever reason
# 1. sudo docker rmi qjackctl --force


# Testing qjackctl
# 1. apt install lmms -y
# 2. qjackctl &
# 3. lmms --allowroot &
# Tell lmms to use jack, restart lmms and play a sample song
# Save your container image as described above.



# Known Issues
# jackctl will freeze up w/ various panels and other apps via apt
# For example apt install obs-studio or apt install lxpanel will freeze up qjackctl
# To work around this do not install them via apt and build from source, or use another GUI app instead of qjackctl
# If qjackctl freeze up the container press <alt><control-key><F3>, log in and killall qjackctl than <alt><control-key><F1> to return
#
# Lmms and various other jack supported apps connect to jack automatically so qjackctl freezing up can be avoided if you want to install a panel
# The app jamin can be used to control the input/outputs to some degree but not as easy as qjackctl.
# Works really well with apps that have some port control themselves builtin like rakarrack or guitarix
# Lmms doesn't seem to have any port control built in ;(
# 1. apt install jamin -y

